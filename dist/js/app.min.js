(function() {
    'use strict';

    angular.module('blog', ['ngRoute', 'blog.controllers', 'blog.templates']);

    function config($locationProvider, $routeProvider) {
        $locationProvider.html5Mode(true);
        $routeProvider
            .when('/', {
                templateUrl: 'views/post-list.tpl.html',
                controller: 'PostListCtrl',
                controllerAs: 'postlist'
            })
            .when('/post/:postId', {
                templateUrl: 'views/post-detail.tpl.html',
                controller: 'PostDetailCtrl',
                controllerAs: 'postdetail'
            })
            .when('/new', {
                templateUrl: 'views/post-create.tpl.html',
                controller: 'PostCreateCtrl',
                controllerAs: 'postcreate'
            });
    }
    angular
        .module('blog')
        .config(config);
})();
(function() {
    'use strict';
    angular.module('blog.controllers', ['blog.services']);

    function PostListCtrl(Post) {
        this.posts = Post.query();
    }


    function PostDetailCtrl($routeParams, Post, User, Comment) {
        this.post = {};
        this.comments = {};
        this.user = {};
        var self = this; // Para guardar la referencia
        Post.query({
            id: $routeParams.postId
        }).$promise.then(
            function(data) {
                self.post = data[0];
                self.user = User.query({
                    id: self.user.userId
                });
            },
            function(error) {
                console.log(error);
            }
        );
        this.comments = Comment.query({
            postId: $routeParams.postId
        });
    }

    function PostCreateCtrl(Post) {
        var self = this;
        this.create = function() {
            Post.save(self.post);
        };
    }

    angular.module('blog.controllers')
        .controller('PostListCtrl', PostListCtrl)
        .controller('PostDetailCtrl', PostDetailCtrl)
        .controller('PostCreateCtrl', PostCreateCtrl);

})();
(function() {
    'use strict';
    angular.module('blog.services', ['ngResource']);

    function Post($resource, BaseUrl) {
        return $resource(BaseUrl + '/posts/:postId', { postId: '@_id' });
    }

    function Comment($resource, BaseUrl) {
        return $resource(BaseUrl + '/comments/:commentId', { commentId: '@_id' });
    }

    function User($resource, BaseUrl) {
        return $resource(BaseUrl + '/users/:userId', { userId: '@_id' });
    }
    angular
        .module('blog.services')
        .constant('BaseUrl', 'http://jsonplaceholder.typicode.com')
        .factory('Post', Post)
        .factory('Comment', Comment)
        .factory('User', User);
})();
angular.module('blog.templates', []).run(['$templateCache', function($templateCache) {$templateCache.put('views/post-create.tpl.html','<section>\r\n    <form name="createPost" role="form" ng-submit="postcreate.create()">\r\n        <fieldset class="form-group">\r\n            <input class="form-control input-lg" type="text" placeholder="T\xEDtulo del Post" ng-model="postcreate.post.title">\r\n        </fieldset>\r\n        <fieldset class="form-group">\r\n            <textarea class="form-control input-lg" placeholder="Texto del Post" ng-model="postcreate.post.text"></textarea>\r\n        </fieldset>\r\n        <hr>\r\n        <button class="btn btn-primary btn-lg" type="submit" ng-disabled="!createPost.$valid"><span class="fa fa-rocket"> Publicar</span></button>\r\n    </form>\r\n</section>');
$templateCache.put('views/post-detail.tpl.html','<article class="blog-post">\r\n    <header class="blog-post-header">\r\n        <h1>{{postdetail.post.title}}</h1>\r\n    </header>\r\n    <p class="blog-post-body">{{postdetail.post.body}}</p>\r\n    <p>Escrito por: <strong>{{postdetail.user[0].name}}</strong><span class="fa fa-mail"></span>{{postdetail.user[0].email}}</p>\r\n</article>\r\n<aside class="comments">\r\n    <header class="comments-header">\r\n        <h3><span class="fa fa-comments"></span>Commentarios</h3>\r\n    </header>\r\n    <ul class="comments-list">\r\n        <li class="comment-item" ng-repeat="comment in postdetail.comments">\r\n            <span class="fa fa-user"></span>\r\n            <span class="comment-author">{{comment.email}}</span>\r\n            <p class="comment-body">\r\n                {{comment.body}}\r\n            </p>\r\n        </li>\r\n    </ul>\r\n</aside>');
$templateCache.put('views/post-list.tpl.html','<ul class="blog-post-list">\r\n    <li class="blog-post-link" ng-repeat="post in postlist.posts"><a ng-href="/post/{{post.id}}">{{post.title}}</a></li>\r\n</ul>');}]);